<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Who Are You?</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=3">
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="screen active splash-screen">
        <div class="splash-content">
            <h1 class="splash-title">Who Are You?</h1>
            <p class="splash-subtitle">Deepen your connection through meaningful questions</p>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcome-screen" class="screen">
        <div class="container welcome-container">
            <h1 class="title">Who Are You?</h1>
            <p class="subtitle">Deepen your connection through meaningful questions</p>
            <p class="subtitle" style="font-size: 1.1rem; margin-top: 20px; color: rgba(255,255,255,0.9);">Choose your game mode to begin</p>

            <div class="game-modes-grid" style="margin-top: 40px;">
                <div class="game-mode-card" onclick="selectGameMode('connection')">
                    <div class="mode-icon">üí≠</div>
                    <h3>Deepen Your Connection</h3>
                    <p class="mode-description">Journey through 5 rounds of meaningful questions that progressively deepen your bond</p>
                    <div class="mode-details">
                        <span class="mode-time">‚è± 20-30 min</span>
                        <span class="mode-type">Classic Mode</span>
                    </div>
                </div>

                <div class="game-mode-card" onclick="selectGameMode('compatibility')">
                    <div class="mode-icon">üß©</div>
                    <h3>Compatibility Test</h3>
                    <p class="mode-description">Discover your compatibility score through 10 science-backed questions about values, communication, and vision</p>
                    <div class="mode-details">
                        <span class="mode-time">‚è± 10-15 min</span>
                        <span class="mode-type">Assessment</span>
                    </div>
                </div>

                <div class="game-mode-card" onclick="selectGameMode('knowledge')">
                    <div class="mode-icon">üéØ</div>
                    <h3>How Well Do You Know Each Other?</h3>
                    <p class="mode-description">Compete to predict each other's answers! Test your knowledge and discover surprising things</p>
                    <div class="mode-details">
                        <span class="mode-time">‚è± 15-20 min</span>
                        <span class="mode-type">Quiz Game</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Join Selection Screen -->
    <div id="create-join-screen" class="screen">
        <div class="container welcome-container">
            <button onclick="showScreen('welcome-screen')" class="back-btn">‚Üê Back</button>
            <h1 class="title">Who Are You?</h1>
            <p class="subtitle">Ready to play <span id="selected-mode-name">your game</span>?</p>
            <div class="mode-buttons">
                <button onclick="showCreateGame()" class="mode-btn">
                    <h3>Create Game</h3>
                    <p>Choose relationship type and get a game code</p>
                </button>
                <button onclick="showJoinGame()" class="mode-btn">
                    <h3>Join Game</h3>
                    <p>Enter a game code to join</p>
                </button>
            </div>
        </div>
    </div>

    <!-- Relationship Selection Screen -->
    <div id="relationship-screen" class="screen">
        <div class="container">
            <button onclick="showScreen('create-join-screen')" class="back-btn">‚Üê Back</button>
            <h2 class="screen-title">Choose Your Relationship</h2>
            <p class="screen-subtitle">Select the relationship type that best describes you</p>
            <div id="relationship-categories" class="relationship-categories">
                <!-- Family Relationships -->
                <div class="category-dropdown">
                    <button class="category-header" onclick="toggleCategory('family')">
                        <span>Family</span>
                        <span class="dropdown-icon">‚ñº</span>
                    </button>
                    <div class="category-content" data-category="family">
                        <div class="relationship-grid">
                            <button onclick="selectRelationship('brother-brother', this)" class="relationship-btn">Brother & Brother</button>
                            <button onclick="selectRelationship('sister-sister', this)" class="relationship-btn">Sister & Sister</button>
                            <button onclick="selectRelationship('brother-sister', this)" class="relationship-btn">Brother & Sister</button>
                            <button onclick="selectRelationship('mother-son', this)" class="relationship-btn">Mother & Son</button>
                            <button onclick="selectRelationship('mother-daughter', this)" class="relationship-btn">Mother & Daughter</button>
                            <button onclick="selectRelationship('father-son', this)" class="relationship-btn">Father & Son</button>
                            <button onclick="selectRelationship('father-daughter', this)" class="relationship-btn">Father & Daughter</button>
                            <button onclick="selectRelationship('grandfather-grandson', this)" class="relationship-btn">Grandfather & Grandson</button>
                            <button onclick="selectRelationship('grandfather-granddaughter', this)" class="relationship-btn">Grandfather & Granddaughter</button>
                            <button onclick="selectRelationship('grandmother-grandson', this)" class="relationship-btn">Grandmother & Grandson</button>
                            <button onclick="selectRelationship('grandmother-granddaughter', this)" class="relationship-btn">Grandmother & Granddaughter</button>
                            <button onclick="selectRelationship('male-cousins', this)" class="relationship-btn">Male Cousins</button>
                            <button onclick="selectRelationship('female-cousins', this)" class="relationship-btn">Female Cousins</button>
                            <button onclick="selectRelationship('mixed-cousins', this)" class="relationship-btn">Male & Female Cousins</button>
                        </div>
                    </div>
                </div>

                <!-- Romantic Relationships -->
                <div class="category-dropdown">
                    <button class="category-header" onclick="toggleCategory('romantic')">
                        <span>Romantic</span>
                        <span class="dropdown-icon">‚ñº</span>
                    </button>
                    <div class="category-content" data-category="romantic">
                        <div class="relationship-grid">
                            <button onclick="selectRelationship('new-dating', this)" class="relationship-btn">New Dating Couple</button>
                            <button onclick="selectRelationship('long-term-partners', this)" class="relationship-btn">Long-term Partners</button>
                            <button onclick="selectRelationship('engaged', this)" class="relationship-btn">Engaged Couple</button>
                            <button onclick="selectRelationship('married', this)" class="relationship-btn">Married Couple</button>
                        </div>
                    </div>
                </div>

                <!-- Friends -->
                <div class="category-dropdown">
                    <button class="category-header" onclick="toggleCategory('friends')">
                        <span>Friends</span>
                        <span class="dropdown-icon">‚ñº</span>
                    </button>
                    <div class="category-content" data-category="friends">
                        <div class="relationship-grid">
                            <button onclick="selectRelationship('best-friends-same', this)" class="relationship-btn">Best Friends (Same Gender)</button>
                            <button onclick="selectRelationship('best-friends-different', this)" class="relationship-btn">Best Friends (Different Gender)</button>
                            <button onclick="selectRelationship('new-friends', this)" class="relationship-btn">New Friends</button>
                            <button onclick="selectRelationship('childhood-friends', this)" class="relationship-btn">Childhood Friends Reconnecting</button>
                            <button onclick="selectRelationship('work-friends', this)" class="relationship-btn">Work Friends</button>
                            <button onclick="selectRelationship('online-friends', this)" class="relationship-btn">Online Friends Meeting IRL</button>
                        </div>
                    </div>
                </div>

                <!-- Other -->
                <div class="category-dropdown">
                    <button class="category-header" onclick="toggleCategory('other')">
                        <span>Other</span>
                        <span class="dropdown-icon">‚ñº</span>
                    </button>
                    <div class="category-content" data-category="other">
                        <div class="relationship-grid">
                            <button onclick="selectRelationship('colleagues', this)" class="relationship-btn">Colleagues</button>
                            <button onclick="selectRelationship('mentor-mentee', this)" class="relationship-btn">Mentor & Mentee</button>
                            <button onclick="selectRelationship('roommates', this)" class="relationship-btn">Roommates</button>
                            <button onclick="selectRelationship('neighbors', this)" class="relationship-btn">Neighbors</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Join Game Screen -->
    <div id="join-screen" class="screen">
        <div class="container">
            <button onclick="showScreen('create-join-screen')" class="back-btn">‚Üê Back</button>
            <h2 class="screen-title">Join Game</h2>
            <p class="screen-subtitle">Enter the game code shared by the host</p>
            
            <div class="join-room-input">
                <input type="text" id="room-code-input" placeholder="Enter game code" maxlength="7">
                <button onclick="joinGameRoom()" class="main-btn">Join Game</button>
            </div>
        </div>
    </div>

    <!-- Room Lobby Screen -->
    <div id="lobby-screen" class="screen">
        <div class="container">
            <div id="lobby-info" style="display: none;">
                <div id="room-info">
                    <p class="code-label">Game Code</p>
                    <div class="code-box">
                        <span id="room-code-display" class="room-code"></span>
                    </div>
                </div>

                <div class="player-inputs">
                    <div class="input-group">
                        <label for="your-name">Your Name</label>
                        <input type="text" id="your-name" placeholder="Enter your name">
                    </div>
                </div>

                <div class="status-container">
                    <div class="status-dot"></div>
                    <p id="lobby-status">Waiting...</p>
                </div>

                <button id="start-online-game" onclick="startOnlineGame()" class="main-btn" disabled>
                    <span>Begin Journey</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Player Setup Screen -->
    <div id="setup-screen" class="screen">
        <div class="container">
            <h2 class="screen-title">Player Setup</h2>
            <div class="player-inputs">
                <div class="input-group">
                    <label for="player1-name">Player 1 Name:</label>
                    <input type="text" id="player1-name" placeholder="Enter your name">
                </div>
                <div class="input-group">
                    <label for="player2-name">Player 2 Name:</label>
                    <input type="text" id="player2-name" placeholder="Enter your name">
                </div>
            </div>
            <button onclick="startGame()" class="main-btn">Begin Journey</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <div class="container">
            <!-- Round Info - Hidden for cleaner UI -->
            <div id="round-header" class="round-header" style="display: none;">
                <h2 id="round-title">Round 1 - Getting Started</h2>
                <p id="round-subtitle">Choose a category and draw a question</p>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <p class="progress-text">Round <span id="current-round-num">1</span> of 5</p>
            </div>

            <!-- Current Turn Info -->
            <div id="turn-info" class="turn-info">
                <p id="current-turn" class="turn-text">Player 1's turn to choose and ask</p>
            </div>

            <!-- Category Selection -->
            <div id="category-selection" class="category-selection">
                <h3>Pick a topic:</h3>
                <div id="categories-container" class="categories-container">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>

            <!-- Question Display -->
            <div id="question-display" class="question-display hidden">
                <div class="card">
                    <h3 id="question-category">Category</h3>
                    <p id="question-text">Question will appear here</p>
                </div>
                <div class="question-actions">
                    <button onclick="saveQuestion()" class="secondary-btn" id="save-question-btn">
                        <span class="heart-icon">‚ô°</span> Save Question
                    </button>
                    <button onclick="nextTurn()" class="main-btn">Answer Complete</button>
                </div>
            </div>

            <!-- Waiting/Answering State -->
            <div id="waiting-state" class="waiting-state hidden">
                <div class="waiting-card">
                    <h3 id="waiting-title">Listening & Answering</h3>
                    <p id="waiting-message">Wait for the other player to ask their question, then share your answer!</p>
                    <div class="waiting-animation">
                        <div class="pulse-dot"></div>
                        <div class="pulse-dot"></div>
                        <div class="pulse-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Round Complete -->
            <div id="round-complete" class="round-complete hidden">
                <h3>Round Complete!</h3>
                <p>Ready for the next round?</p>
                <button onclick="nextRound()" class="main-btn">
                    <span>Continue</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Compatibility Test Screen -->
    <div id="compatibility-screen" class="screen">
        <div class="container">
            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="compatibility-progress-fill" class="progress-fill"></div>
                </div>
                <p class="progress-text">Question <span id="compatibility-question-num">1</span> of 10</p>
            </div>

            <!-- Question Display -->
            <div id="compatibility-question-display" class="compatibility-question-display">
                <div class="card">
                    <h3 id="compatibility-question-text">Question will appear here</h3>
                    <p class="ranking-instruction">Drag to reorder from most important (top) to least important (bottom)</p>
                    <div id="compatibility-answers" class="compatibility-ranking-list">
                        <!-- Ranking items will be populated by JavaScript -->
                    </div>
                    <button id="submit-ranking-btn" class="main-btn" onclick="submitRanking()" style="margin-top: 20px;">Submit Ranking</button>
                </div>
            </div>

            <!-- Waiting for Partner -->
            <div id="compatibility-waiting" class="waiting-state hidden">
                <div class="waiting-card">
                    <h3>Waiting for your partner...</h3>
                    <p>They're answering the question</p>
                    <div class="waiting-animation">
                        <div class="pulse-dot"></div>
                        <div class="pulse-dot"></div>
                        <div class="pulse-dot"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Compatibility Comparison Screen -->
    <div id="compatibility-comparison-screen" class="screen">
        <div class="container">
            <div class="comparison-container">
                <h2 class="comparison-title">How You Compared</h2>
                <p class="comparison-subtitle" id="comparison-question-text">Question text will appear here</p>

                <!-- Match Score Badge -->
                <div class="comparison-match-badge">
                    <div class="match-percentage" id="comparison-match-percentage">0%</div>
                    <p class="match-label">Match on this question</p>
                </div>

                <!-- Rankings Comparison -->
                <div class="rankings-comparison">
                    <!-- Player 1 Rankings -->
                    <div class="player-rankings">
                        <h3 class="player-rankings-title" id="comparison-player1-name">Player 1</h3>
                        <div class="ranking-list" id="comparison-player1-rankings">
                            <!-- Rankings will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Player 2 Rankings -->
                    <div class="player-rankings">
                        <h3 class="player-rankings-title" id="comparison-player2-name">Player 2</h3>
                        <div class="ranking-list" id="comparison-player2-rankings">
                            <!-- Rankings will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Continue Button -->
                <button onclick="continueToNextQuestion()" class="main-btn continue-btn">
                    Continue to Next Question
                </button>
            </div>
        </div>
    </div>

    <!-- Compatibility Results Screen -->
    <div id="compatibility-results-screen" class="screen">
        <div class="container">
            <div id="compatibility-results-content" style="display: none;">
                <h2 class="complete-title">Compatibility Results</h2>

                <div class="compatibility-score-display">
                    <div class="score-circle">
                        <span id="compatibility-score-number">0</span>
                        <span class="score-percent">%</span>
                    </div>
                    <h3 id="compatibility-rating">Great Match!</h3>
                    <p id="compatibility-message">You share strong alignment in key areas</p>
                </div>

                <div class="compatibility-breakdown">
                    <h3>Compatibility Breakdown</h3>
                    <div id="compatibility-categories"></div>
                </div>

                <div class="compatibility-insights">
                    <h3>Insights & Growth Areas</h3>
                    <div id="compatibility-insights-content"></div>
                </div>

                <div class="complete-actions">
                    <button onclick="shareCompatibilityResults()" class="secondary-btn">Share Results</button>
                    <button onclick="restartGame()" class="main-btn">Start New Journey</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Knowledge Quiz Screen -->
    <div id="knowledge-screen" class="screen">
        <div class="container">
            <!-- Score Display -->
            <div class="knowledge-score-bar">
                <div class="player-score">
                    <span id="knowledge-player1-name">Player 1</span>: <span id="knowledge-player1-score">0</span>
                </div>
                <div class="player-score">
                    <span id="knowledge-player2-name">Player 2</span>: <span id="knowledge-player2-score">0</span>
                </div>
            </div>

            <!-- Progress -->
            <div class="progress-container">
                <p class="progress-text">Question <span id="knowledge-question-num">1</span> of 15</p>
            </div>

            <!-- Answer Phase -->
            <div id="knowledge-answer-phase" class="knowledge-phase hidden">
                <div class="card">
                    <div class="phase-indicator">üìù Answer</div>
                    <h3 id="knowledge-question-text">Question will appear here</h3>
                    <p class="knowledge-instruction"><span id="knowledge-answerer-name">Player 1</span>, choose your answer:</p>
                    <div id="knowledge-answer-options" class="knowledge-options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Prediction Phase -->
            <div id="knowledge-predict-phase" class="knowledge-phase hidden">
                <div class="card">
                    <div class="phase-indicator">üîÆ Predict</div>
                    <h3 id="knowledge-predict-question">Question will appear here</h3>
                    <p class="knowledge-instruction"><span id="knowledge-predictor-name">Player 2</span>, what do you think they answered?</p>
                    <div id="knowledge-predict-options" class="knowledge-options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Result Phase -->
            <div id="knowledge-result-phase" class="knowledge-phase hidden">
                <div class="card knowledge-result-card">
                    <div id="knowledge-result-icon" class="result-icon">‚úì</div>
                    <h3 id="knowledge-result-title">Correct!</h3>
                    <p id="knowledge-result-message">You know each other well!</p>
                    <div class="answer-reveal">
                        <p>The answer was: <strong id="knowledge-correct-answer">Answer</strong></p>
                    </div>
                    <button onclick="nextKnowledgeQuestion()" class="main-btn">Continue</button>
                </div>
            </div>

            <!-- Waiting State -->
            <div id="knowledge-waiting" class="waiting-state hidden">
                <div class="waiting-card">
                    <h3>Waiting for your partner...</h3>
                    <div class="waiting-animation">
                        <div class="pulse-dot"></div>
                        <div class="pulse-dot"></div>
                        <div class="pulse-dot"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Knowledge Quiz Results Screen -->
    <div id="knowledge-results-screen" class="screen">
        <div class="container">
            <div id="knowledge-results-content" style="display: none;">
                <h2 class="complete-title">Quiz Complete!</h2>

                <div class="knowledge-final-scores">
                    <div class="final-score-card">
                        <h3 id="knowledge-final-player1-name">Player 1</h3>
                        <div class="final-score-number">
                            <span id="knowledge-final-player1-score">0</span>
                            <span class="score-total">/15</span>
                        </div>
                        <p class="score-percentage"><span id="knowledge-final-player1-percent">0</span>% accuracy</p>
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="final-score-card">
                        <h3 id="knowledge-final-player2-name">Player 2</h3>
                        <div class="final-score-number">
                            <span id="knowledge-final-player2-score">0</span>
                            <span class="score-total">/15</span>
                        </div>
                        <p class="score-percentage"><span id="knowledge-final-player2-percent">0</span>% accuracy</p>
                    </div>
                </div>

                <div class="knowledge-winner">
                    <h3 id="knowledge-winner-text">It's a tie!</h3>
                    <p id="knowledge-winner-message">You both know each other equally well!</p>
                </div>

                <div class="complete-actions">
                    <button onclick="shareKnowledgeResults()" class="secondary-btn">Share Results</button>
                    <button onclick="restartGame()" class="main-btn">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Round Announcement Overlay -->
    <div id="round-announcement" class="round-announcement">
        <div class="round-announcement-content">
            <h1 id="announcement-title" class="round-announcement-title">Round 1</h1>
            <p id="announcement-subtitle" class="round-announcement-subtitle">Getting Started</p>
        </div>
    </div>

    <!-- Game Complete Screen -->
    <div id="complete-screen" class="screen">
        <div class="container">
            <div id="complete-content" style="display: none;">
                <h2 class="complete-title">Journey Complete!</h2>
                <p class="complete-message">You've shared meaningful moments and deepened your connection</p>

                <div id="saved-questions-summary" class="saved-summary">
                    <!-- Will be populated by JavaScript if questions were saved -->
                </div>

                <div class="complete-actions">
                    <button onclick="shareExperience()" class="secondary-btn">Share Your Journey</button>
                    <button onclick="restartGame()" class="main-btn">Start New Journey</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    
    <!-- Scripts -->
    <script src="config.js?v=3"></script>
    <script src="questions.js?v=3"></script>
    <script src="compatibility-questions-ranking.js?v=3"></script>
    <script src="knowledge-questions.js?v=3"></script>
    <script src="script.js?v=3"></script>
</body>
</html>